<h1 id="unit-testing">Unit Testing<a aria-hidden="true" class="anchor-heading icon-link" href="#unit-testing"></a></h1>
<p>El unit testing puede mejor considerablemente la calidad de nuestro codigo. Nos aseguran que el codigo que estamos cambiando sigue siendo funcional bajo unos estandares. Como los Web Components corren nativamente en el navegador, podemos correr unit test usando cualquier framework de Javascript.</p>
<p>Para este caso vamos a usar el componente dropdown que desarrollamos en <a href="/notes/ik9twe6vf70yht7mt79j88t">Lit</a>. </p>
<p>Los proyectos <a title="Private" href="https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html" target="_blank" class="private">Open Web Components (Private)</a> y <a title="Private" href="https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html" target="_blank" class="private">Modern Web (Private)</a> proveen una suit de utilidades para el testeo de Web Components y Web Components construidos con Lit.</p>
<h2 id="setting-up-the-test-runner">Setting up the Test Runner<a aria-hidden="true" class="anchor-heading icon-link" href="#setting-up-the-test-runner"></a></h2>
<p>Con nuestro dropdown, podemos escribir distintos casos de test pero primero vamos a hacer la configuraci√≥n incial de nuestra suite de tests. Para correr nuestros test vamos a necesitar un <code>test runner</code>. Vamos a usar <code>@web/test-runner</code>  para correrlos nativamente en el navegador.
Tambien vamos a necesitar una libreria de testeo para correr aserciones para nuestor codigo. <code>@open-wc</code> tiene unas muy buenas opciones para esto.</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"14-unit-test"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Basic unit testing example"</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"web-dev-server --node-resolve --open"</span><span class="token punctuation">,</span>
    <span class="token property">"clean"</span><span class="token operator">:</span> <span class="token string">"find . -name 'node_modules' -exec rm -rf '{}' +"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"web-test-runner ./**/*.spec.ts --node-resolve"</span><span class="token punctuation">,</span>
    <span class="token property">"test:watch"</span><span class="token operator">:</span> <span class="token string">"web-test-runner ./**/*.spec.ts --node-resolve --watch"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"lit"</span><span class="token operator">:</span> <span class="token string">"^2.0.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"@open-wc/testing"</span><span class="token operator">:</span> <span class="token string">"^2.5.33"</span><span class="token punctuation">,</span>
    <span class="token property">"@web/dev-server"</span><span class="token operator">:</span> <span class="token string">"^0.1.24"</span><span class="token punctuation">,</span>
    <span class="token property">"@web/dev-server-esbuild"</span><span class="token operator">:</span> <span class="token string">"^0.2.14"</span><span class="token punctuation">,</span>
    <span class="token property">"@web/test-runner"</span><span class="token operator">:</span> <span class="token string">"^0.13.18"</span><span class="token punctuation">,</span>
    <span class="token property">"@web/test-runner-puppeteer"</span><span class="token operator">:</span> <span class="token string">"^0.13.1"</span><span class="token punctuation">,</span>
    <span class="token property">"typescript"</span><span class="token operator">:</span> <span class="token string">"^4.4.3"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>El paquete <code>@open-wc</code> nos provee de utilidades para test. <code>@web/dev-server</code> y <code>@web/test-server</code> nos permite correr localhost y test runners. <code>@web/dev-server-esbuild</code> y <code>typescript</code> nos permitiran escribir nuestros componentes y nuestros unit test en typescript. </p>
<p>Vamos a ver el <code>web-test-runner.config.mjs</code> en el root del proyecto.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>esbuildPlugin<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@web/dev-server-esbuild'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>puppeteerLauncher<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@web/test-runner-puppeteer'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">nodeResolve</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rootDir</span><span class="token operator">:</span> <span class="token string">'./'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">esbuildPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">ts</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'esnext'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">browsers</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">puppeteerLauncher</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">launchOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">executablePath</span><span class="token operator">:</span> <span class="token string">'/usr/bin/chromium-browser'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Esta configuracion nos permite configurar y agregar plugins a nuestros test. Como usamos Lit y Typescript podemos usar el plugin de esbuild para compilar nuestro codigo.</p>
<h2 id="unit-test-structure">Unit Test Structure<a aria-hidden="true" class="anchor-heading icon-link" href="#unit-test-structure"></a></h2>
<p>Vamos a iniciar con nuestro componente para testear lo que creamos en otras secciones</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">LitElement</span><span class="token punctuation">,</span> html<span class="token punctuation">,</span> css <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'lit'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> property <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'lit/decorators/property.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> customElement <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'lit/decorators/custom-element.js'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">customElement</span></span><span class="token punctuation">(</span><span class="token string">'x-dropdown'</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">XDropdown</span></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token maybe-class-name">LitElement</span></span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token known-class-name class-name">Boolean</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> open <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token known-class-name class-name">String</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> title <span class="token operator">=</span> <span class="token string">'dropdown'</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> styles <span class="token operator">=</span> <span class="token punctuation">[</span>css<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token css language-css">
    <span class="token selector">div</span> <span class="token punctuation">{</span>
      <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span> solid <span class="token hexcode color">#ccc</span><span class="token punctuation">;</span>
      <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token unit">px</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html">
      <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span></span><span class="token punctuation">></span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">title</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>button</span><span class="token punctuation">></span></span>
      <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">open</span>  <span class="token operator">?</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span> <span class="token interpolation-punctuation punctuation">}</span></span>
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">open</span> <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">open</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token maybe-class-name">CustomEvent</span></span><span class="token punctuation">(</span><span class="token string">'openChange'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> detail<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">open</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>En nuestro archivo <code>dropdown.spec.ts</code> escribimos la configuracion basica de nuestro test</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>expect<span class="token punctuation">,</span> fixture<span class="token punctuation">,</span> html<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"@open-wc/testing"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span><span class="token maybe-class-name">Dropdown</span><span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"./dropdown"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token string">"./dropdown"</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"x-dropdown"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'creates component'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">fixture</span><span class="token punctuation">(</span>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>x-dropdown</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>x-dropdown</span><span class="token punctuation">></span></span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span><span class="token property-access">tagName</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token string">"X-DROPDOWN"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>El paquete <code>@open-wc/testing</code> nos provee de utilizades para testear componentes de Lit. Los test estan organizados utilizando <code>describe</code> y <code>it</code> en bloques de funciones. La funcion <code>describe</code> define que es lo que estamos testeando, y la funcion <code>it</code> corre nuestro <code>expect</code> para cada comportamiento que querramos testear.</p>
<p>Para nuestro primer ejemplo, nuestro test va a chequear que nuestro componente se haya creado correctamente. Como nuestro componente esta hecho con <code>Lit</code>, la template se va a renderizar de manera asincrona. Podemos usa <code>fixture</code> para esperar hasta que el componente haya sido completamente renderizado y asi poder obtener una referencia a el. Esto asegura que el componente fue renderizado y esta disponible para que nosotros accedamos dentro de nuestro test.</p>
<h2 id="primer-test-unitario">Primer Test Unitario<a aria-hidden="true" class="anchor-heading icon-link" href="#primer-test-unitario"></a></h2>
<p>Para nuestro primer test, podemos chequear que cuando la propiedad <code>open</code> sea <code>falsa</code>, el dropdown este oculto con <code>hidden</code>. Por el contrario que tambien este visible cuando <code>open=true</code>.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>expect<span class="token punctuation">,</span> fixture<span class="token punctuation">,</span> html<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"@open-wc/testing"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span><span class="token maybe-class-name">Dropdown</span><span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"./dropdown"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token string">"./dropdown"</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"x-dropdown"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'creates component'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">fixture</span><span class="token punctuation">(</span>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>x-dropdown</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>x-dropdown</span><span class="token punctuation">></span></span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span><span class="token property-access">tagName</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token string">"X-DROPDOWN"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should open and close dropdown when open property is set'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token generic-function"><span class="token function">fixture</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Dropdown</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>x-dropdown</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>x-dropdown</span><span class="token punctuation">></span></span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">await</span> element<span class="token punctuation">.</span><span class="token property-access">updateComplete</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token property-access">open</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token property-access">shadowRoot</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Usando <code>await</code> y <code>fixture</code> podemos esperar a que nuestro componente este completamente renderizado. Luego esperamos que <code>open=false</code>, podemos hacerle una query a nuestro <code>shadowRoot</code> para asegurarnos de que el <code>div</code> no se renderizo.</p>
<p>Para correr los test, podemos usar el siguiente comando</p>
<pre class="language-bash"><code class="language-bash">webn-test-runner ./**/*.spec.ts --node-resolve
</code></pre>
<p>O nuestro script que ya configuramos en el <code>package.json</code></p>
<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> run <span class="token builtin class-name">test</span>
</code></pre>
<p>Si todo esta bien instalado deberiamos ver el siguiente resultado en nuestra consola
<img src="/image-29.png" alt="Alt text"></p>
<p>Ahora mejoremos el test para ver si cuando el <code>open</code> es <code>true</code> nuestro dropdown se muestra como es esperado.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> expect<span class="token punctuation">,</span> fixture<span class="token punctuation">,</span> html<span class="token punctuation">,</span> elementUpdated <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@open-wc/testing'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">XDropdown</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./dropdown.element.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token string">'./dropdown.element.js'</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'x-dropdown'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'creates component'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">fixture</span><span class="token punctuation">(</span>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>x-dropdown</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>x-dropdown</span><span class="token punctuation">></span></span> </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should open and close dropdown when open property is set'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token generic-function"><span class="token function">fixture</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">XDropdown</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>x-dropdown</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>x-dropdown</span><span class="token punctuation">></span></span> </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token property-access">open</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token property-access">shadowRoot</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    element<span class="token punctuation">.</span><span class="token property-access">open</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">await</span> <span class="token function">elementUpdated</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token property-access">shadowRoot</span><span class="token punctuation">.</span><span class="token property-access">innerHTML</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token property-access">shadowRoot</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">tagName</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token string">'DIV'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should open and close dropdown when button is clicked'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token generic-function"><span class="token function">fixture</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">XDropdown</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>x-dropdown</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>x-dropdown</span><span class="token punctuation">></span></span> </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">await</span> element<span class="token punctuation">.</span><span class="token property-access">updateComplete</span><span class="token punctuation">;</span>

    element<span class="token punctuation">.</span><span class="token property-access">shadowRoot</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">await</span> element<span class="token punctuation">.</span><span class="token property-access">updateComplete</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token property-access">open</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token property-access">shadowRoot</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">tagName</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token string">'DIV'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    element<span class="token punctuation">.</span><span class="token property-access">shadowRoot</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">await</span> element<span class="token punctuation">.</span><span class="token property-access">updateComplete</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token property-access">open</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token property-access">shadowRoot</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre>
<p>Con esto al correr <code>npm run test</code> ya podremos ver que nuestros tests pasan correctamente y hemos terminado con el unit testing.</p>